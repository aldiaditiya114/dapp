<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lumera Protocol dApp</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 40px 0;
        }
        
        .header h1 {
            color: white;
            font-size: 3rem;
            margin-bottom: 10px;
            font-weight: 700;
            text-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        
        .header p {
            color: rgba(255,255,255,0.9);
            font-size: 1.2rem;
            font-weight: 300;
        }
        
        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            transition: all 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 25px 50px rgba(0,0,0,0.15);
        }
        
        .card h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.6);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            box-shadow: 0 4px 15px rgba(116, 185, 255, 0.4);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #00b894 0%, #00a085 100%);
            box-shadow: 0 4px 15px rgba(0, 184, 148, 0.4);
        }
        
        .input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e1e8ed;
            border-radius: 12px;
            font-size: 1rem;
            margin-bottom: 15px;
            transition: border-color 0.3s ease;
            background: rgba(255,255,255,0.8);
        }
        
        .input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .wallet-status {
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
            font-weight: 600;
            text-align: center;
        }
        
        .connected {
            background: linear-gradient(135deg, #d4f4dd 0%, #a8e6cf 100%);
            color: #27ae60;
        }
        
        .disconnected {
            background: linear-gradient(135deg, #ffeaa7 0%, #fab1a0 100%);
            color: #e17055;
        }
        
        .balance-display {
            background: linear-gradient(135deg, #a29bfe 0%, #6c5ce7 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.5rem;
            font-weight: 700;
        }
        
        .faucet-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .network-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }
        
        .info-item {
            background: rgba(116, 185, 255, 0.1);
            padding: 15px;
            border-radius: 12px;
            border-left: 4px solid #74b9ff;
        }
        
        .info-item strong {
            color: #2c3e50;
            display: block;
            margin-bottom: 5px;
        }
        
        .info-item span {
            color: #636e72;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.9rem;
            word-break: break-all;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .alert {
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
            font-weight: 500;
        }
        
        .alert-error {
            background: linear-gradient(135deg, #ff7675 0%, #e84393 100%);
            color: white;
        }
        
        .alert-success {
            background: linear-gradient(135deg, #00b894 0%, #00cec9 100%);
            color: white;
        }
        
        .footer {
            text-align: center;
            margin-top: 50px;
            padding: 30px;
            color: rgba(255,255,255,0.8);
        }
        
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .card {
                padding: 20px;
            }
            
            .grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ Lumera Protocol dApp</h1>
            <p>Next-gen blockchain for AI-driven Web3 economies</p>
        </div>
        
        <div class="grid">
            <!-- Wallet Connection Card -->
            <div class="card">
                <h2>üîó Wallet Connection</h2>
                <div id="walletStatus" class="wallet-status disconnected">
                    Wallet not connected
                </div>
                <div id="balanceDisplay" class="balance-display" style="display: none;">
                    <div>Balance: <span id="balance">0</span> LUME</div>
                </div>
                <button id="connectBtn" class="btn" onclick="connectWallet()">
                    Connect Keplr Wallet
                </button>
                <button id="disconnectBtn" class="btn btn-secondary" onclick="disconnectWallet()" style="display: none; margin-left: 10px;">
                    Disconnect
                </button>
            </div>
            
            <!-- Transfer Card -->
            <div class="card">
                <h2>üí∏ Transfer LUME</h2>
                <input type="text" id="recipientAddress" class="input" placeholder="Recipient address (lumera...)" disabled>
                <input type="number" id="transferAmount" class="input" placeholder="Amount (LUME)" disabled step="0.000001">
                <button id="transferBtn" class="btn btn-success" onclick="transferTokens()" disabled>
                    <span id="transferBtnText">Send Tokens</span>
                </button>
            </div>
        </div>
        
        <!-- Network Information -->
        <div class="card">
            <h2>üåê Network Information</h2>
            <div class="network-info">
                <div class="info-item">
                    <strong>Chain ID:</strong>
                    <span>lumera-testnet-2</span>
                </div>
                <div class="info-item">
                    <strong>RPC Endpoint:</strong>
                    <span>https://lumera-testnet-rpc.linknode.org/</span>
                </div>
                <div class="info-item">
                    <strong>Address Prefix:</strong>
                    <span>lumera</span>
                </div>
                <div class="info-item">
                    <strong>Token Symbol:</strong>
                    <span>LUME</span>
                </div>
                <div class="info-item">
                    <strong>Token Decimals:</strong>
                    <span>6</span>
                </div>
                <div class="info-item">
                    <strong>Base Denomination:</strong>
                    <span>ulume</span>
                </div>
            </div>
        </div>
        
        <!-- Faucet Links -->
        <div class="card">
            <h2>üö∞ Get Test LUME Tokens</h2>
            <p style="margin-bottom: 20px; color: #636e72;">Get free testnet tokens from these faucets:</p>
            <div class="faucet-grid">
                <a href="https://faucet-lumera.winnode.xyz/" target="_blank" class="btn btn-secondary">WinNode Faucet</a>
                <a href="https://faucet.astrostake.xyz/" target="_blank" class="btn btn-secondary">Astrostake Faucet</a>
                <a href="https://lumera-faucet-maouam.nodelab.my.id/" target="_blank" class="btn btn-secondary">NodeLab Faucet</a>
                <a href="https://lumera-faucet.vercel.app/" target="_blank" class="btn btn-secondary">Vercel Faucet</a>
                <a href="https://wh-faucet.netlify.app/" target="_blank" class="btn btn-secondary">WH Faucet</a>
            </div>
        </div>
        
        <div class="footer">
            <p>Built for Lumera Protocol Testnet | Zealy Quest dApp</p>
            <p>Made with ‚ù§Ô∏è for the Lumera community</p>
        </div>
    </div>

    <script>
        // Lumera Network Configuration
        const LUMERA_CONFIG = {
            chainId: "lumera-testnet-2",
            chainName: "Lumera Testnet",
            rpc: "https://lumera-testnet-rpc.linknode.org/",
            rest: "https://lumera-testnet-api.linknode.org/",
            bip44: { coinType: 118 },
            bech32Config: {
                bech32PrefixAccAddr: "lumera",
                bech32PrefixAccPub: "lumerapub",
                bech32PrefixValAddr: "lumeravaloper",
                bech32PrefixValPub: "lumeravaloperpub",
                bech32PrefixConsAddr: "lumeravalcons",
                bech32PrefixConsPub: "lumeravalconspub"
            },
            currencies: [
                {
                    coinDenom: "LUME",
                    coinMinimalDenom: "ulume",
                    coinDecimals: 6,
                    coinGeckoId: "lumera"
                }
            ],
            feeCurrencies: [
                {
                    coinDenom: "LUME",
                    coinMinimalDenom: "ulume",
                    coinDecimals: 6,
                    coinGeckoId: "lumera",
                    gasPriceStep: {
                        low: 0.005,
                        average: 0.025,
                        high: 0.04
                    }
                }
            ],
            stakeCurrency: {
                coinDenom: "LUME",
                coinMinimalDenom: "ulume",
                coinDecimals: 6,
                coinGeckoId: "lumera"
            }
        };

        let userAddress = null;
        let keplrOfflineSigner = null;

        // Check if Keplr is installed
        function checkKeplr() {
            if (!window.keplr) {
                showAlert('Keplr wallet not found. Please install Keplr extension.', 'error');
                return false;
            }
            return true;
        }

        // Connect to Keplr Wallet
        async function connectWallet() {
            if (!checkKeplr()) return;

            const connectBtn = document.getElementById('connectBtn');
            connectBtn.innerHTML = '<span class="loading"></span> Connecting...';
            connectBtn.disabled = true;

            try {
                // Suggest the Lumera chain to Keplr
                try {
                    await window.keplr.experimentalSuggestChain(LUMERA_CONFIG);
                } catch (error) {
                    console.error('Error suggesting chain:', error);
                }

                // Enable the chain
                await window.keplr.enable(LUMERA_CONFIG.chainId);
                
                // Get offline signer
                keplrOfflineSigner = await window.keplr.getOfflineSigner(LUMERA_CONFIG.chainId);
                
                // Get user accounts
                const accounts = await keplrOfflineSigner.getAccounts();
                userAddress = accounts[0].address;

                // Update UI
                updateWalletUI(true);
                await updateBalance();
                showAlert('Wallet connected successfully!', 'success');

            } catch (error) {
                console.error('Connection error:', error);
                showAlert('Failed to connect wallet: ' + error.message, 'error');
            } finally {
                connectBtn.innerHTML = 'Connect Keplr Wallet';
                connectBtn.disabled = false;
            }
        }

        // Disconnect wallet
        function disconnectWallet() {
            userAddress = null;
            keplrOfflineSigner = null;
            updateWalletUI(false);
            showAlert('Wallet disconnected', 'success');
        }

        // Update wallet UI
        function updateWalletUI(connected) {
            const walletStatus = document.getElementById('walletStatus');
            const connectBtn = document.getElementById('connectBtn');
            const disconnectBtn = document.getElementById('disconnectBtn');
            const balanceDisplay = document.getElementById('balanceDisplay');
            const transferInputs = document.querySelectorAll('#recipientAddress, #transferAmount');
            const transferBtn = document.getElementById('transferBtn');

            if (connected) {
                walletStatus.textContent = `Connected: ${userAddress.substring(0, 20)}...`;
                walletStatus.className = 'wallet-status connected';
                connectBtn.style.display = 'none';
                disconnectBtn.style.display = 'inline-block';
                balanceDisplay.style.display = 'block';
                transferInputs.forEach(input => input.disabled = false);
                transferBtn.disabled = false;
            } else {
                walletStatus.textContent = 'Wallet not connected';
                walletStatus.className = 'wallet-status disconnected';
                connectBtn.style.display = 'inline-block';
                disconnectBtn.style.display = 'none';
                balanceDisplay.style.display = 'none';
                transferInputs.forEach(input => {
                    input.disabled = true;
                    input.value = '';
                });
                transferBtn.disabled = true;
                document.getElementById('balance').textContent = '0';
            }
        }

        // Get balance
        async function updateBalance() {
            if (!userAddress) return;

            try {
                const response = await fetch(`${LUMERA_CONFIG.rest}/cosmos/bank/v1beta1/balances/${userAddress}`);
                const data = await response.json();
                
                let balance = 0;
                if (data.balances && data.balances.length > 0) {
                    const lumeBalance = data.balances.find(b => b.denom === 'ulume');
                    if (lumeBalance) {
                        balance = (parseInt(lumeBalance.amount) / 1000000).toFixed(6);
                    }
                }
                
                document.getElementById('balance').textContent = balance;
            } catch (error) {
                console.error('Error fetching balance:', error);
                document.getElementById('balance').textContent = 'Error';
            }
        }

        // Transfer tokens
        async function transferTokens() {
            if (!userAddress || !keplrOfflineSigner) return;

            const recipient = document.getElementById('recipientAddress').value.trim();
            const amount = document.getElementById('transferAmount').value.trim();
            const transferBtn = document.getElementById('transferBtn');
            const transferBtnText = document.getElementById('transferBtnText');

            if (!recipient || !amount) {
                showAlert('Please enter recipient address and amount', 'error');
                return;
            }

            if (!recipient.startsWith('lumera')) {
                showAlert('Invalid recipient address. Must start with "lumera"', 'error');
                return;
            }

            if (parseFloat(amount) <= 0) {
                showAlert('Amount must be greater than 0', 'error');
                return;
            }

            transferBtn.disabled = true;
            transferBtnText.innerHTML = '<span class="loading"></span> Sending...';

            try {
                // Import necessary modules for signing
                const { SigningStargateClient } = await import('https://esm.sh/@cosmjs/stargate@0.32.2');
                
                const client = await SigningStargateClient.connectWithSigner(
                    LUMERA_CONFIG.rpc,
                    keplrOfflineSigner,
                    {
                        gasPrice: {
                            denom: 'ulume',
                            amount: '0.025'
                        }
                    }
                );

                const amountInMicroLume = Math.floor(parseFloat(amount) * 1000000);
                
                const msg = {
                    typeUrl: '/cosmos.bank.v1beta1.MsgSend',
                    value: {
                        fromAddress: userAddress,
                        toAddress: recipient,
                        amount: [{
                            denom: 'ulume',
                            amount: amountInMicroLume.toString()
                        }]
                    }
                };

                const result = await client.signAndBroadcast(userAddress, [msg], 'auto');
                
                if (result.code === 0) {
                    showAlert(`Transfer successful! TX: ${result.transactionHash}`, 'success');
                    document.getElementById('recipientAddress').value = '';
                    document.getElementById('transferAmount').value = '';
                    setTimeout(() => updateBalance(), 2000);
                } else {
                    throw new Error(`Transaction failed: ${result.rawLog}`);
                }

            } catch (error) {
                console.error('Transfer error:', error);
                showAlert('Transfer failed: ' + error.message, 'error');
            } finally {
                transferBtn.disabled = false;
                transferBtnText.textContent = 'Send Tokens';
            }
        }

        // Show alert messages
        function showAlert(message, type) {
            const existingAlert = document.querySelector('.alert');
            if (existingAlert) {
                existingAlert.remove();
            }

            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.textContent = message;
            
            const container = document.querySelector('.container');
            container.insertBefore(alert, container.firstChild.nextSibling);

            setTimeout(() => {
                alert.remove();
            }, 5000);
        }

        // Auto-refresh balance every 30 seconds
        setInterval(() => {
            if (userAddress) {
                updateBalance();
            }
        }, 30000);

        // Check if Keplr is available on page load
        window.addEventListener('load', () => {
            if (window.keplr) {
                console.log('Keplr detected');
            } else {
                showAlert('Keplr wallet not detected. Please install Keplr extension to use this dApp.', 'error');
            }
        });
    </script>
</body>
</html>
